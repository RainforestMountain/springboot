<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.lotterysystem.dao.mapper.ActivityUserMapper">
    <insert id="batchInsert" parameterType="list"
            useGeneratedKeys="true" keyProperty="activityId" keyColumn="id">
        INSERT INTO activity_user (activity_id, user_id, user_name, status)
        VALUES
        <foreach collection="items" item="item" index="index" separator=",">
            (
            #{item.activityId},
            #{item.userId},
            #{item.userName},
            #{item.status}
            )
        </foreach>
        <!-- 添加安全垫防止空列表 -->
        <if test="items == null or items.isEmpty()">
            (null, null, null, null) /* 避免SQL语法错误 */
        </if>
    </insert>

    <!--    <insert id="batchInsert" parameterType="list"-->
<!--            useGeneratedKeys="true" keyProperty="id" keyColumn="id">-->
<!--        -->
<!--    </insert>-->
    <update id="batchUpdateStatus">
        UPDATE activity_user
        SET status = #{status}
        WHERE activity_id = #{activityId}
        AND user_id IN
        <foreach collection="userIds" item="userId" open="(" separator="," close=")">
            #{userId}
        </foreach>
    </update>
</mapper>